\documentclass[10pt, a4paper]{article}
\usepackage[paper=a4paper, left=1.5cm, right=1.5cm, bottom=1.5cm, top=3.5cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{indentfirst}
\usepackage{fancyhdr}
\usepackage{a4wide}
\usepackage[dvipsnames,usenames]{color}
\usepackage{float}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{listingsutf8}
\usepackage{graphicx}
\usepackage{subfloat}
\usepackage{framed}
\usepackage{amsfonts}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{lastpage}
\usepackage[colorlinks=true, linkcolor=blue]{hyperref} \usepackage{calc}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{multicol}

\newcommand{\f}[1]{\text{#1}}
\newcommand{\real}{\mathbb{R}}
\newcommand{\nat}{\mathbb{N}}
\newcommand{\eme}{\mathcal{M}}
\newcommand{\emeh}{\widehat{\mathcal{M}}}
\newcommand{\ere}{\mathcal{R}}

\sloppy

\setlength{\voffset}{-0.5cm}
\setlength{\hoffset}{0.7cm}
\setlength{\headsep}{0pt}
\setlength{\headheight}{0pt}
\setlength{\oddsidemargin}{-0.7in}
\setlength{\marginparwidth}{-0.5cm}
\setlength{\textwidth}{18cm}
\setlength{\footskip}{2pt}
\setlength{\topmargin}{0in}
\setlength{\textheight}{25cm}
\setlength{\fboxrule}{3pt}

\begin{document}
\thispagestyle{empty}
\begin{center}

\Huge{ \bf{UNIVERSIDAD DE BUENOS AIRES}}
\\
\LARGE{\bf{Facultad de Ciencias Exactas y Naturales}}
\\
\textbf{Departamento de Computaci\'on}
\\
\textbf{Organizaci\'on del Computador}
\vspace{2.0\baselineskip}
\end{center}


\begin{figure}[h] %[h] Aqui [b] para button [t] para top
\begin{center}
\includegraphics[width=100pt]{./image.jpeg}
\end{center}
\end{figure}
\begin{center}
\vspace*{0.7cm}

\huge{\bf RECUPERATORIO AL TRABAJO PR\'ACTICO N\'UMERO 3}\\
\huge{Nombre de Grupo: Napolitana con Jam\'on y Morrones}
\vspace*{8cm}

\end{center}

\huge{\textbf{Alumnos:}}\\
\\
\vspace*{0.3cm}
\Large{\textsl{Izcovich, Sabrina} $|$ sizcovich@gmail.com $|$ LU 550/11}\\
\vspace*{0.3cm}
\Large{\textsl{L\'opez Veluscek, Matías} \hspace{0.1cm}$|$ milopezv@gmail.com $|$ 926/10}\\

 
\newpage
%Pagina de titulo e indice
\thispagestyle{empty}
%\large{
\tableofcontents
%}
\newpage
\section{Introducci\'on}
El siguiente trabajo práctico consiste en un conjunto de ejercicios en los que se aplican de forma gradual los conceptos de System Programming vistos a lo largo de la materia. El objetivo de éste consiste en construir un sistema capaz de correr el juego \textit{Infección}. Para la realización del mismo, debimos crear el soporte para que los jugadores (o sea las tareas) puedan ejecutar las reglas del juego. Dado que las tareas eran capaces de hacer cualquier cosa, debimos considerar que el sistema debía tener la capacidad de capturar cualquier problema y poder quitar a la tarea del juego.\newline
A lo largo del trabajo práctico, se utilizaron los mecanismos que posee el procesador para la programación desde el punto de vista del sistema operativo enfocados sobre el sistema de protección. En lo que sigue, se detallan explícitamente los pasos realizados para lograr el objetivo mencionado.

\section{Ejercicio 1}
En el primer ejercicio, nos limitamos a completar la GDT conformada por un arreglo de gdt\_entry's tomando como ejemplo la GDT\_NULL provista por la cátedra. Para ello, debimos definir tres segmentos de códigos y de datos, manteniendo el segmento NULL para el buen funcionamiento de la estructura. El primero de ellos (el 0) correspondiente al kernel, el segundo (el 2) al árbitro y el tercero (el 3) a los jugadores. Dado que la GDT tiene un formato de segmentacion flat, la base de cada segmento comienza en 0 y el límite consiste en el tamaño de lo que deseamos mapear. Cada segmento fue completado del siguiente modo:

\begin{table}[H]
\centering
    \begin{tabular}{|c|l|}
        \hline
        0xFFFF & limit[0:15] \\ 
        0x0000 & base[0:15] \\
        0x00 & base[23:16] \\ 
        0x02 & type \\ 
        0x01 & s \\ 
        0x00 & dpl \\ 
        0x01 & p \\ 
        0x07 & limit[16:19] \\ 
        0x00 & avl \\ 
        0x00 & l \\ 
        0x01 & db \\ 
        0x01 & g \\ 
        0x00 & base[31:24] \\ 
        \hline
    \end{tabular}
    \caption{GDT}
\end{table}

Las diferencias entre DATA y CODE 
{\subsection{Pregunta 1:}} \textbf{¿Qué ocurre si se intenta escribir en la fila 26, columna 1 de la matriz de video, utilizando el segmento de la GDT que direcciona a la memoria de video? ¿Por qué?}\newline
\newline
\textit{La consecuencia de intentar escribir en la fila 26, columna 1 de la matriz de video accediendola desde el segmento declarado, es que se produce una interrupción 13(General Protection) porque se accede a memoria fuera del segmento.}\newline
\newline
{\subsection{Pregunta 2:}} \textbf{¿Qué ocurre si no se setean todos los registros de segmento al entrar en modo protegido? ¿Es necesario setearlos todos? ¿Por qué?}\newline
\newline
\textit{En el caso en el que los registros no se seteen se genera un General Protection; al menos se necesitan CS, DS y SS configurados correctamente para el funcionamiento en modo protegido, estos son el selector de c\'odigo, el selector de datos y el selector de stack respectivamente. Para respetar la convenci\'on C se deben inicializar tambi\'en los selectores de prop\'osito general, ES, FS y GS, al mismo valor que DS.}

\subsection{Ejercicio 2}
{\textbf{Pregunta 3:}} \textbf{¿Cómo se puede hacer para generar una excepción sin utilizar la instrucción int? Mencionar al menos 3 formas posibles.}\newline
\newline
\textit{
	Para generar una excepci\'on sin utilizar la instrucci\'on \texttt{int} se puede hacer uso de los siguientes m\'etodos:
	\begin{itemize}
		\item Dividiendo por 0.
		\item Escribiendo a un sector de memoria que no esta mapeado en la unidad de segmentaci\'on y/o paginaci\'on.
		\item Escribiendo a un sector de la memoria para el cual no se tiene suficiente nivel de permiso.
	\end{itemize}
}

{\subsection{Pregunta 4:}} \textbf{¿Cuáles son los valores del stack cuando se genera una interrupción? ¿Qué significan? (Indicar para el caso de operar en nivel 3 y nivel 0).}\newline
\newline
Cuando se genera una interrupción, se debe preservar el estado actual de los flags y todos los registros que son necesarios para retornar a la normal ejecución una vez resuelta la interrupción.
Cuando se produce la interrupción puede que sucedan 2 cosas, la interrupción tiene el mismo nivel de privilegio que el proceso en el que se generó o bien tiene un privilegio diferente. Exceptuando la tarea Idle que se ejecuta en nivel 0, todas las tareas, tanto \'arbitro como jugadores, se ejecutan en un nivel de privilegio menor que 0, por lo que siempre que suceda una interrupción de nivel 0 se producirá un cambio de privilegio con lo que el stack de la interrupción para una interrupción de nivel 0 es del formato de cambio de privilegio. Además, las interrupciones de servicio requieren un privilegio 2 o 3 para ser utilizadas, en cuyo caso las tareas no cambiarían de nivel al pedir llamar al servicio provisto para su nivel.

\begin{table}[h]
	\begin{minipage}{0.7\textwidth}
		\hspace*{0.3\textwidth}
		\begin{tabular}{|c|}
			\\ \hline
			Error Code \\ \hline
			EIP \\ \hline
			CS \\ \hline
			EFLAGS \\ \hline
			\\
		\end{tabular}
		\caption{Stack de interrupción sin cambio de privilegio}
	\end{minipage}
	~
	\begin{minipage}{0.7\textwidth}
		\hspace*{0.3\textwidth}
		\begin{tabular}{|c|}
			\\ \hline
			Error Code \\ \hline
			EIP \\ \hline
			CS \\ \hline
			EFLAGS \\ \hline
			ESP \\ \hline
			SS \\ \hline
			\\
		\end{tabular}
		\caption{Stack de interrupción con cambio de privilegio}
	\end{minipage}
\end{table}

Los datos que se almacenan por automático son entonces:
\begin{itemize}
	\item SS: El selector de segmento donde se encuentra el stack del nivel anterior, el cual se preserva por el cambio de stack al cambiar el privilegio.
	\item ESP: El puntero a la posición de memoria donde estaba el ESP antes del cambio de privilegio, el cual se preserva por el cambio de stack al cambiar el privilegio.
	\item EFLAGS: El registro que contiene el estado de los flags del sistema. Como muchas operaciones afectan el estado de este registro, se debe conservar para asegurarse de que el estado del proceso que se interrumpió sea el mismo que al salir de la interrupción.
	\item CS: El selector de segmento del proceso interrumpido.
	\item EIP: El puntero que indica que dirección se debe ejecutar al retornar de la interrupción.
	\item Error Code: El código de error, en caso de existir para la interrupci\'on, codifica información extra sobre el error para facilitar el diagn\'ostico del motivo de la interrupci\'on ya que pueden haber m\'ultiples causas.
\end{itemize}

El Error Code tiene 32 bits, de los cuales los bits 16 a 31 están reservados para mantener el stack alineado. El bit 0(EXT) indica si la interrupción es por un evento externo al procesador, el bit 1(IDT) indica si el índice, que va de los bits 3 a 15, hace referencia a un elemento de la IDT o a un descriptor en la GDT/LDT y el bit 2(TI) indica, solo en caso de que le bit 1 indique que se trata de un descriptor de GDT/LDT, en que tabla se encuentra el descriptor.

\subsection{Ejercicio 3}
{\subsection{Pregunta 5:}} \textbf{¿Puede el directorio de páginas estar en cualquier posición arbitraria de memoria?}\newline
\newline
\textit{
	El directorio de p\'aginas debe estar en una p\'agina de 4kb ya que ocupa ese espacio en memoria; dicha p\'agina debe encontrarse en el espacio de memoria accesible antes de activar la paginaci\'on pues debe ser creada antes de activarla, de no tener un directiorio de p\'aginas al activar la paginaci\'on se produce un Page Fault ya que no tiene p\'aginas mapeadas ni un page directory en el que buscarlas.
}
{\subsection{Pregunta 6:}} \textbf{¿Es posible acceder a una página de nivel de kernel desde usuario?}\newline
\newline
\textit{
	Una p\'agina con privilegio de superusuario no puede ser accedida por un proceso con nivel de usuario, sin embargo un proceso con nivel de super usuario si puede acceder a una p\'agina con privilegio de usuario.
}

{\subsection{Pregunta 7:}} \textbf{¿Se puede mapear una página física desde dos direcciones virtuales
distintas, de manera tal que una esté mapeada con nivel de usuario y la otra a nivel de kernel? De ser posible, ¿Qué problemas puede traer?}\newline
\newline
\textit{
	Es posible, sin embargo el permitir el acceso a una misma p\'agina desde distintas direcciones virtuales con distinto privilegio podr\'ia permitir a un usuario modificar o acceder a datos que solo un superusuario deber\'ia poder acceder.
}

\section{Ejercicio 4}
{\subsection{Pregunta 8:}} \textbf{¿Qué permisos pueden tener las tablas y directorios de páginas? ¿Cuáles son los permisos efectivos de una dirección de memoria según los permisos del directorio y tabla de páginas?}\newline
\newline
\textit{Las tablas y directorios de páginas pueden tener permisos de usuario o supervisor, lectura o lectura/escritura. El permiso efectivo de una dirección de memoria es, principalmente, el permiso de la tabla de páginas. Esto se debe a que los permisos del page directory indican el permiso que se tiene sobre el page table mapeado en la pde con lo cual, si se tiene permiso de lectura, se aplican los permisos de la pte. En el caso en el que el page directory indicara que el page table tiene permiso de usuario entonces el usuario no tendría acceso a las páginas mapeadas en ese table.}

{\subsection{Pregunta 9:}} \textbf{¿Es posible desde dos directorios de página, referenciar a una misma tabla de páginas?}\newline
\newline
\textit{Es posible desde dos directorios de página referenciar a una misma tabla de páginas. Para que esto ocurra, debe escribirse la dirección de la tabla que se quiere referenciar en la entrada de cada directorio de tablas de páginas. Por ejemplo, esto puede ocurrir cuando dos tareas con directorios propios quieran referenciar las mismas páginas con distintos privilegios en las mismas direcciones físicas.}

{\subsection{Pregunta 10:}} \textbf{¿Qué es TLB (Translation Lookaside Buffer) y para qué sirve?}\newline
\newline
\textit{Consiste en una tabla en el proceso de memoria que contiene información sobre las páginas en memoria que el procesador accedió recientemente. La tabla hace remisión a direcciones virtuales del programa con las direcciones correspondientes en la memoria física que el programa usó más recientemente. El TLB permite mayor velocidad computacional debido a que facilita el proceso de direcciones que toman lugar independientemente del canal normal de traducción de direcciones.}

\section{Ejercicio 5}
{\subsection{Pregunta 11:}} \textbf{¿Qué pasa si en la interrupción de teclado no se lee la tecla presionada?}\newline
\newline
\textit{En el caso en el que la interrupción del teclado no lea la tecla presionada, dicha interrupción tendría un único comportamiento dado que no existe manera de saber qué tecla fue pulsada.}

{\subsection{Pregunta 12:}} \textbf{¿Qué pasa si no se resetea el PIC?}\newline
\newline
\textit{En el caso en el que el PIC no sea reseteado, más de una interrupción puede ser atendida por el mismo handler. Esto se debe a que el PIC se encuentra mapeado por defecto sobre interrupciones del sistema, por lo tanto, hay que configurarlo para que quede fuera del rango de las interrupciones de Intel.}

\section{Ejercicio 6}

{\subsection{Pregunta 13:}} \textbf{Colocando un breakpoint luego de cargar una tarea, ¿Cómo se puede verificar, utilizando el debugger de Bochs, que la tarea se cargó correctamente?
¿Cómo se llega a esta conclusión?}\newline
\newline
\textit{Para verificar que una tarea fue cargada correctamente, se puede pedir el $info\ tss$ en BOCHS y verificar que en el $TR$ se encuentra el selector de segmento que apunta al descriptor de tss de la tarea en la GDT. Por otro lado, el bit de Busy debe hallarse encendido.}

{\subsection{Pregunta 14:}} \textbf{¿Cómo se puede verificar que la conmutación de tarea fue exitosa?}\newline
\newline
\textit{Dicha verificación puede realizarse a partir de los registros TR y CR3. Si se deseara comprobar que la tarea desde la que se saltó guardó correctamente los valores en la tss, se debe volver a saltar a ella misma y comprobar que dichos valores sean los mismos.}


{\subsection{Pregunta 15:}} \textbf{Se sabe que las tareas llaman a la interrupción \texttt{0x80} y por \texttt{0x90}, ¿qué ocurre si esta no está implementada? ¿Por qué?}\newline
\newline
\textit{En el caso en el que se llame a la interrupción 0x80 y 0x90 y éstas no se encuentren definidas, se genera un General Protection.}

\section{Ejercicio 7}


\end{document}
